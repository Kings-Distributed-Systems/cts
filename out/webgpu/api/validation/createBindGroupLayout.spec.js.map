{"version":3,"sources":["../../../../src/webgpu/api/validation/createBindGroupLayout.spec.ts"],"names":["description","pbool","poptions","params","makeTestGroup","kBindingTypeInfo","kBindingTypes","kMaxBindingsPerBindGroup","kShaderStages","kShaderStageCombinations","ValidationTest","clone","descriptor","JSON","parse","stringify","g","test","fn","t","goodDescriptor","entries","binding","visibility","GPUShaderStage","COMPUTE","type","device","createBindGroupLayout","badDescriptor","expectValidationError","combine","hasDynamicOffset","info","supportsDynamicOffset","perPipelineLimitClass","maxDynamic","success","validStages","maxDynamicBufferCount","maxDynamicBufferBindings","i","push","length","pickExtraBindingTypes","bindingType","extraTypeSame","extraBindingType","perStageLimitClass","class","kCasesForMaxResourcesPerStageTests","filter","p","maxedType","maxedVisibility","expand","extraType","extraVisibility","maxedTypeInfo","maxedCount","max","extraTypeInfo","maxResourceBindings","storageTextureFormat","resource","undefined","newDescriptor","shouldError","goodLayout","createPipelineLayout","bindGroupLayouts","extraLayout","newBindingCountsTowardSamePerStageLimit","layoutExceedsPerStageLimit"],"mappings":"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","sourcesContent":["export const description = `\ncreateBindGroupLayout validation tests.\n`;\n\nimport { pbool, poptions, params } from '../../../common/framework/params_builder.js';\nimport { makeTestGroup } from '../../../common/framework/test_group.js';\nimport {\n  kBindingTypeInfo,\n  kBindingTypes,\n  kMaxBindingsPerBindGroup,\n  kShaderStages,\n  kShaderStageCombinations,\n} from '../../capability_info.js';\n\nimport { ValidationTest } from './validation_test.js';\n\nfunction clone<T extends GPUBindGroupLayoutDescriptor>(descriptor: T): T {\n  return JSON.parse(JSON.stringify(descriptor));\n}\n\nexport const g = makeTestGroup(ValidationTest);\n\ng.test('some_binding_index_was_specified_more_than_once').fn(async t => {\n  const goodDescriptor = {\n    entries: [\n      { binding: 0, visibility: GPUShaderStage.COMPUTE, type: 'storage-buffer' as const },\n      { binding: 1, visibility: GPUShaderStage.COMPUTE, type: 'storage-buffer' as const },\n    ],\n  };\n\n  // Control case\n  t.device.createBindGroupLayout(goodDescriptor);\n\n  const badDescriptor = clone(goodDescriptor);\n  badDescriptor.entries[1].binding = 0;\n\n  // Binding index 0 can't be specified twice.\n  t.expectValidationError(() => {\n    t.device.createBindGroupLayout(badDescriptor);\n  });\n});\n\ng.test('visibility_and_dynamic_offsets')\n  .params(\n    params()\n      .combine(poptions('type', kBindingTypes))\n      .combine(pbool('hasDynamicOffset'))\n      .combine(poptions('visibility', kShaderStageCombinations))\n  )\n  .fn(async t => {\n    const { type, hasDynamicOffset, visibility } = t.params;\n    const info = kBindingTypeInfo[type as GPUBindingType];\n\n    const supportsDynamicOffset = kBindingTypeInfo[type].perPipelineLimitClass.maxDynamic > 0;\n    let success = true;\n    if (!supportsDynamicOffset && hasDynamicOffset) success = false;\n    if ((visibility & ~info.validStages) !== 0) success = false;\n\n    // When hasDynamicOffset is false, it actually tests visibility.\n    t.expectValidationError(() => {\n      t.device.createBindGroupLayout({\n        entries: [{ binding: 0, visibility, type, hasDynamicOffset }],\n      });\n    }, !success);\n  });\n\ng.test('number_of_dynamic_buffers_exceeds_the_maximum_value')\n  .params([\n    { type: 'storage-buffer' as const, maxDynamicBufferCount: 4 },\n    { type: 'uniform-buffer' as const, maxDynamicBufferCount: 8 },\n  ])\n  .fn(async t => {\n    const { type, maxDynamicBufferCount } = t.params;\n\n    const maxDynamicBufferBindings: GPUBindGroupLayoutEntry[] = [];\n    for (let i = 0; i < maxDynamicBufferCount; i++) {\n      maxDynamicBufferBindings.push({\n        binding: i,\n        visibility: GPUShaderStage.COMPUTE,\n        type,\n        hasDynamicOffset: true,\n      });\n    }\n\n    const goodDescriptor = {\n      entries: [\n        ...maxDynamicBufferBindings,\n        {\n          binding: maxDynamicBufferBindings.length,\n          visibility: GPUShaderStage.COMPUTE,\n          type,\n          hasDynamicOffset: false,\n        },\n      ],\n    };\n\n    // Control case\n    t.device.createBindGroupLayout(goodDescriptor);\n\n    // Dynamic buffers exceed maximum in a bind group layout.\n    const badDescriptor = clone(goodDescriptor);\n    badDescriptor.entries[maxDynamicBufferCount].hasDynamicOffset = true;\n\n    t.expectValidationError(() => {\n      t.device.createBindGroupLayout(badDescriptor);\n    });\n  });\n\n// One bind group layout will be filled with kPerStageBindingLimit[...] of the type |type|.\n// For each item in the array returned here, a case will be generated which tests a pipeline\n// layout with one extra bind group layout with one extra binding. That extra binding will have:\n//\n//   - If extraTypeSame, any of the binding types which counts toward the same limit as |type|.\n//     (i.e. 'storage-buffer' <-> 'readonly-storage-buffer').\n//   - Otherwise, an arbitrary other type.\nfunction* pickExtraBindingTypes(\n  bindingType: GPUBindingType,\n  extraTypeSame: boolean\n): IterableIterator<GPUBindingType> {\n  const info = kBindingTypeInfo[bindingType];\n  if (extraTypeSame) {\n    for (const extraBindingType of kBindingTypes) {\n      if (\n        info.perStageLimitClass.class ===\n        kBindingTypeInfo[extraBindingType].perStageLimitClass.class\n      ) {\n        yield extraBindingType;\n      }\n    }\n  } else {\n    yield info.perStageLimitClass.class === 'sampler' ? 'sampled-texture' : 'sampler';\n  }\n}\n\nconst kCasesForMaxResourcesPerStageTests = params()\n  .combine(poptions('maxedType', kBindingTypes))\n  .combine(poptions('maxedVisibility', kShaderStages))\n  .filter(p => (kBindingTypeInfo[p.maxedType].validStages & p.maxedVisibility) !== 0)\n  .expand(function* (p) {\n    for (const extraTypeSame of [true, false]) {\n      yield* poptions('extraType', pickExtraBindingTypes(p.maxedType, extraTypeSame));\n    }\n  })\n  .combine(poptions('extraVisibility', kShaderStages))\n  .filter(p => (kBindingTypeInfo[p.extraType].validStages & p.extraVisibility) !== 0);\n\n// Should never fail unless kMaxBindingsPerBindGroup is exceeded, because the validation for\n// resources-of-type-per-stage is in pipeline layout creation.\ng.test('max_resources_per_stage,in_bind_group_layout')\n  .params(kCasesForMaxResourcesPerStageTests)\n  .fn(async t => {\n    const { maxedType, extraType, maxedVisibility, extraVisibility } = t.params;\n    const maxedTypeInfo = kBindingTypeInfo[maxedType];\n    const maxedCount = maxedTypeInfo.perStageLimitClass.max;\n    const extraTypeInfo = kBindingTypeInfo[extraType];\n\n    const maxResourceBindings: GPUBindGroupLayoutEntry[] = [];\n    for (let i = 0; i < maxedCount; i++) {\n      maxResourceBindings.push({\n        binding: i,\n        visibility: maxedVisibility,\n        type: maxedType,\n        storageTextureFormat: maxedTypeInfo.resource === 'storageTex' ? 'rgba8unorm' : undefined,\n      });\n    }\n\n    const goodDescriptor = { entries: maxResourceBindings };\n\n    // Control\n    t.device.createBindGroupLayout(goodDescriptor);\n\n    const newDescriptor = clone(goodDescriptor);\n    newDescriptor.entries.push({\n      binding: maxedCount,\n      visibility: extraVisibility,\n      type: extraType,\n      storageTextureFormat: extraTypeInfo.resource === 'storageTex' ? 'rgba8unorm' : undefined,\n    });\n\n    const shouldError = maxedCount >= kMaxBindingsPerBindGroup;\n\n    t.expectValidationError(() => {\n      t.device.createBindGroupLayout(newDescriptor);\n    }, shouldError);\n  });\n\n// One pipeline layout can have a maximum number of each type of binding *per stage* (which is\n// different for each type). Test that the max works, then add one more binding of same-or-different\n// type and same-or-different visibility.\ng.test('max_resources_per_stage,in_pipeline_layout')\n  .params(kCasesForMaxResourcesPerStageTests)\n  .fn(async t => {\n    const { maxedType, extraType, maxedVisibility, extraVisibility } = t.params;\n    const maxedTypeInfo = kBindingTypeInfo[maxedType];\n    const maxedCount = maxedTypeInfo.perStageLimitClass.max;\n    const extraTypeInfo = kBindingTypeInfo[extraType];\n\n    const maxResourceBindings: GPUBindGroupLayoutEntry[] = [];\n    for (let i = 0; i < maxedCount; i++) {\n      maxResourceBindings.push({\n        binding: i,\n        visibility: maxedVisibility,\n        type: maxedType,\n        storageTextureFormat: maxedTypeInfo.resource === 'storageTex' ? 'rgba8unorm' : undefined,\n      });\n    }\n\n    const goodLayout = t.device.createBindGroupLayout({ entries: maxResourceBindings });\n\n    // Control\n    t.device.createPipelineLayout({ bindGroupLayouts: [goodLayout] });\n\n    const extraLayout = t.device.createBindGroupLayout({\n      entries: [\n        {\n          binding: 0,\n          visibility: extraVisibility,\n          type: extraType,\n          storageTextureFormat: extraTypeInfo.resource === 'storageTex' ? 'rgba8unorm' : undefined,\n        },\n      ],\n    });\n\n    // Some binding types use the same limit, e.g. 'storage-buffer' and 'readonly-storage-buffer'.\n    const newBindingCountsTowardSamePerStageLimit =\n      (maxedVisibility & extraVisibility) !== 0 &&\n      kBindingTypeInfo[maxedType].perStageLimitClass.class ===\n        kBindingTypeInfo[extraType].perStageLimitClass.class;\n    const layoutExceedsPerStageLimit = newBindingCountsTowardSamePerStageLimit;\n\n    t.expectValidationError(() => {\n      t.device.createPipelineLayout({ bindGroupLayouts: [goodLayout, extraLayout] });\n    }, layoutExceedsPerStageLimit);\n  });\n"],"file":"createBindGroupLayout.spec.js"}